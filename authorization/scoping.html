<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
      <title>GraphQL - Scoping</title>
    
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400" rel="stylesheet" />
    <link rel="stylesheet" href="/css/main.css">
    <link rel="icon" href="/graphql-ruby-icon.png">
  </head>
  <body>
    <div class="header">
      <div class="header-container">
        <div class="nav">
          <a href="/" class="img-link">
            <img src="/graphql-ruby.png" alt="GraphQL Ruby Logo" />
          </a>
          <a href="/getting_started">Get Started</a>
          <a href="/guides">Guides</a>
          <a href="/api-doc/1.12.5/">API</a>
          <a href="https://tinyletter.com/graphql-ruby">Newsletter</a>
          <a href="https://github.com/rmosolgo/graphql-ruby">Source Code</a>
          <a href="https://graphql.pro">Upgrade to Pro</a>
          <input
            class="search-input"
            onkeyup="GraphQLRubySearch.run(this)"
            type="text"
            placeholder="Search the docs..."
          />
        </div>
      </div>
      <div class="search-results-container">
        <div id="search-results">
        </div>
      </div>
    </div>
    <div class="container">
      <p class="breadcrumb">
  <a href="/">GraphQL</a>
  &raquo; <a href="/guides">Guides</a>
   &raquo; <a href="/guides#authorization-guides">Authorization</a>
  &raquo; Scoping
</p>


<h1 class="guide-header">Scoping</h1>
<div class="guide-container">
  <p><em>Scoping</em> is a complementary consideration to authorization. Rather than checking “can this user see this thing?”, scoping takes a list of items filters it to the subset which is appropriate for the current viewer and context. The resulting subset is authorized as normal, and, assuming that it was properly scoped, each item should pass authorization checks.</p>

<p>For similar features, see <a href="https://github.com/varvet/pundit#scopes">Pundit scopes</a> and <a href="https://github.com/cancancommunity/cancancan/wiki/Fetching-Records">Cancan’s <code class="language-plaintext highlighter-rouge">.accessible_by</code></a>.</p>

<h2 id="scope-option"><code class="language-plaintext highlighter-rouge">scope:</code> option</h2>

<p>Fields accept a <code class="language-plaintext highlighter-rouge">scope:</code> option to enable (or disable) scoping, for example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">field</span> <span class="ss">:products</span><span class="p">,</span> <span class="p">[</span><span class="no">Types</span><span class="o">::</span><span class="no">Product</span><span class="p">],</span> <span class="ss">scope: </span><span class="kp">true</span>
<span class="c1"># Or</span>
<span class="n">field</span> <span class="ss">:all_products</span><span class="p">,</span> <span class="p">[</span><span class="no">Types</span><span class="o">::</span><span class="no">Product</span><span class="p">],</span> <span class="ss">scope: </span><span class="kp">false</span>
</code></pre></div></div>

<p>For <strong>list</strong> and <strong>connection</strong> fields, <code class="language-plaintext highlighter-rouge">scope: true</code> is the default. For all other fields, <code class="language-plaintext highlighter-rouge">scope: false</code> is the default. You can override this by using the <code class="language-plaintext highlighter-rouge">scope:</code> option.</p>

<h2 id="scope_itemsitems-ctx-method"><code class="language-plaintext highlighter-rouge">.scope_items(items, ctx)</code> method</h2>

<p>Type classes may implement <code class="language-plaintext highlighter-rouge">.scope_items(items, ctx)</code>. This method is called when a field has <code class="language-plaintext highlighter-rouge">scope: true</code>. For example,</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">field</span> <span class="ss">:products</span><span class="p">,</span> <span class="p">[</span><span class="no">Types</span><span class="o">::</span><span class="no">Product</span><span class="p">]</span> <span class="c1"># has `scope: true` by default</span>
</code></pre></div></div>

<p>Will call:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Types::Product</span> <span class="o">&lt;</span> <span class="no">Types</span><span class="o">::</span><span class="no">BaseObject</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">scope_items</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
    <span class="c1"># filter items here</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The method should return a new list with only the appropriate items for the current <code class="language-plaintext highlighter-rouge">context</code>.</p>

</div>
<p class="guide-footer">
  Suggestion, improvement, or correction?
  <a href="https://github.com/rmosolgo/graphql-ruby/edit/master/guides/authorization/scoping.md">Edit this file</a> or
  <a href="https://github.com/rmosolgo/graphql-ruby/issues/new?title=Guide: Scoping">report an issue</a>.
</p>
<script>
  // Find headers with IDs and wrap their text in `<a href=></a>`
  // That way people can easily copy the link.
  var headers = document.querySelectorAll("h1, h2, h3, h4, h5");
  var header, idText, headerLink;
  for (var i = 0; i < headers.length; i++) {
    header = headers[i];
    idText = header.id;
    if (idText) {
      headerLink = document.createElement("a");
      headerLink.href = "#" + idText;
      headerLink.textContent = header.textContent;
      header.textContent = "";
      header.appendChild(headerLink);
    }
  }
</script>

    </div>
    <script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearchLite.min.js"></script>
    <script src="/js/search.js"></script>
  </body>
</html>
